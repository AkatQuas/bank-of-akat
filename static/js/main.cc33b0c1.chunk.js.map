{"version":3,"sources":["shared/header-bar.tsx","shared/simple-context.tsx","invoice/context.ts","invoice/choose-image.tsx","shared/name-input.tsx","invoice/info.tsx","shared/button.tsx","invoice/generateImage.ts","invoice/generate.tsx","invoice/index.tsx","shared/weixin-fallback.tsx","App.tsx","index.tsx","assets/logo.png"],"names":["HeaderBar","React","memo","className","src","logoImg","alt","reducer","initialState","ctx","createContext","state","dispatch","props","useReducer","Provider","value","simpleContext","action","type","img","payload","name","amount","InvoiceContext","InvoiceProvider","ChooseImage","useContext","handleInputChange","useCallback","e","files","target","url","window","URL","createObjectURL","error","console","warn","labelCls","id","accept","onChange","htmlFor","_Input","label","placeholder","defaultProps","Input","Info","onNameChange","onAmountChange","inputMode","pattern","_Button","onClick","block","useMemo","_type","_block","Button","certificatePath","process","watermarkPath","ROOT_2","createCanvas","width","height","canvas","document","createElement","getContext","clearRect","loadImage","Promise","resolve","reject","setAttribute","onload","onerror","Error","imageContain","a4w","w","h","a4h","Math","round","watermarkPosition","ratio","today","Date","getDate","l","step","theta","acos","patchTheta","PI","x","y","p1","p2","sin","p3","cos","map","point","watermarkCanvas","watermarkPNG","globalAlpha","positions","forEach","position","drawImage","imgSrc","a","currency","rootCanvas","rootCtx","all","transcationPNG","certificatePNG","transcationWH","save","textAlign","font","fillText","restore","date","getFullYear","toString","getMonth","slice","toFixed","replace","toBlob","blob","Generate","ref","useRef","useEffect","current","generate","generateImage","then","saveAs","catch","Invoice","WeiXinFallback","App","isWeixin","navigator","userAgent","toLowerCase","indexOf","ReactDOM","render","getElementById","module","exports"],"mappings":"sOAqBaA,EAAYC,IAAMC,MAlBZ,kBACjB,6BACE,yBAAKC,UAAU,SACf,yBACEA,UAAS,oHAQT,yBAAKC,IAAKC,IAASC,IAAI,eAAeH,UAAU,iBAChD,yBAAKA,UAAU,WAAf,qBAK0C,kBAAM,K,oBCnB/C,SACLI,EACAC,GAEA,IAEMC,EAAMR,IAAMS,cAAc,CAC9BC,MAAOH,EACPI,SAJkD,kBAAMJ,KAY1D,MAAO,CAACC,EALR,SAAkBI,GAAqC,IAAD,EAC1BZ,IAAMa,WAAiDP,EAASC,GADtC,mBAC7CG,EAD6C,KACtCC,EADsC,KAEpD,OAAO,kBAACH,EAAIM,SAAL,eAAcC,MAAO,CAAEL,QAAOC,aAAgBC,MCsBRI,EAtBjD,SAAiBN,EAAiBO,GAChC,OAAQA,EAAOC,MACb,IAAK,UACH,OAAO,eACFR,EADL,CAEES,IAAKF,EAAOG,UAEhB,IAAK,WACH,OAAO,eACFV,EADL,CAEEW,KAAMJ,EAAOG,UAEjB,IAAK,aACH,OAAO,eACFV,EADL,CAEEY,OAAQL,EAAOG,UAEnB,QACE,OAAOV,KA1BQ,CACnBS,IAAK,GACLE,KAAM,GACNC,OAAQ,I,mBA2BIC,E,KAAgBC,E,KCuBjBC,EAAczB,IAAMC,MAzDZ,WAAO,IAAD,EACGD,IAAM0B,WAAWH,GAArCZ,EADiB,EACjBA,SAAUD,EADO,EACPA,MAEZiB,EAAoBC,uBACxB,SAACC,GACC,IAAMC,EAASD,EAAEE,OAA4BD,MAC7C,GAAKA,EAGL,IACE,IAAME,EAAMC,OAAOC,IAAIC,gBAAgBL,EAAM,IAC7CnB,EAAS,CACPO,KAAM,UACNE,QAASY,IAEX,MAAOI,GACPC,QAAQC,KAAK,+BAAgCF,MAGjD,CAACzB,IAGKQ,EAAQT,EAARS,IACFoB,EAAW,gCACdpB,EAAM,YAAc,IACvB,OACE,yBAAKjB,UAAU,eACb,yBAAKA,UAAU,2CACb,2BACEsC,GAAG,cACHtB,KAAK,OACLhB,UAAU,mBACVuC,OAAO,UACPC,SAAUf,IAGVR,EAEI,yBACEhB,IAAKgB,EACLd,IAAI,aACJH,UAAU,oCAGZ,KAEN,2BACEA,UAAWqC,EACXI,QAAQ,eAFV,6CC/CFC,EAAS,SAAC,GAAD,IACbC,EADa,EACbA,MACAH,EAFa,EAEbA,SACA3B,EAHa,EAGbA,MACA+B,EAJa,EAIbA,YACA5B,EALa,EAKbA,KALa,OAOX,yBAAKhB,UAAU,gCACb,0BACEA,UAAU,QACV2C,EAFF,KAGA,2BACE3B,KAAMA,EACNhB,UAAU,aACV4C,YAAaA,EACbJ,SAAUA,EACV3B,MAAOA,MAKf6B,EAAOG,aAAe,CACpBL,SAAU,aACV3B,MAAO,GACP+B,YAAa,GACb5B,KAAM,OACN2B,MAAO,IAGF,IAAMG,EAAQhD,IAAMC,KAAK2C,GCyBnBK,EAAOjD,IAAMC,MApDZ,WAAO,IAAD,EACUyB,qBAAWH,GAA/Bb,EADU,EACVA,MAAOC,EADG,EACHA,SACTuC,EAAetB,uBACnB,SAACC,GACClB,EAAS,CACPO,KAAM,WACNE,QAAUS,EAAEE,OAA4BhB,UAG5C,CAACJ,IAGGwC,EAAiBvB,uBACrB,SAACC,GACClB,EAAS,CACPO,KAAM,aACNE,SAAWS,EAAEE,OAA4BhB,UAG7C,CAACJ,IAGH,OACE,6BAEID,EAAMS,IAEF,kBAAC,WAAD,KACE,kBAAC6B,EAAD,CACEjC,MAAOL,EAAMW,KACbqB,SAAUQ,EACVE,UAAU,OACVN,YAAY,kBACZD,MAAM,YAER,kBAACG,EAAD,CACEjC,MAAOL,EAAMY,OACboB,SAAUS,EACVC,UAAU,UACVN,YAAY,mBACZO,QAAQ,SACRR,MAAM,YAKV,S,OC/BNS,EAAU,SAAC,GAOX,IALFT,EAKC,EALDA,MACAU,EAIC,EAJDA,QACArC,EAGC,EAHDA,KACAsC,EAEC,EAFDA,MAGItD,EAAYuD,mBAAQ,WACxB,IACIC,EAAQ,OACZ,OAAQxC,GACN,IAAK,UACH,MACF,IAAK,UACHwC,EAAQ,QACR,MACF,IAAK,OACHA,EAAQ,OACR,MACF,IAAK,OACHA,EAAQ,SACR,MACF,IAAK,QACHA,EAAQ,MAKZ,IAAMC,GAAmB,IAAVH,EACX,eACA,GACJ,MAAM,GAAN,OAvBU,2CAuBV,eAAqBE,EAArB,gBAAkCC,KACjC,CAACH,EAAOtC,IACX,OACE,4BACEhB,UAAWA,EACXqD,QAASA,GAERV,IAKPS,EAAQP,aAlDa,CACnBQ,QAAS,aACTrC,KAAM,UACNsC,OAAO,GAiDF,IAAMI,EAAS5D,IAAMC,KAAKqD,G,uBCjE3BO,EAAkBC,gCAClBC,EAAgBD,8BAEhBE,EAAS,mBAEf,SAASC,EAAaC,EAAeC,GACnCA,EAASA,GAAUD,EACnB,IAAME,EAA4BC,SAASC,cAAc,UACzDF,EAAOF,MAAQA,EACfE,EAAOD,OAASA,EAEhB,IAAM3D,EAAM4D,EAAOG,WAAW,MAG9B,OAFG,OAAH/D,QAAG,IAAHA,KAAKgE,UAAU,EAAG,EAAGN,EAAOC,GAErBC,EAGT,IAAMK,EAAY,SAACtE,GAAD,OAA4C,IAAIuE,SAAQ,SAACC,EAASC,GAClF,IAAMzD,EAAMkD,SAASC,cAAc,OACnCnD,EAAI0D,aAAa,cAAe,aAChC1D,EAAI2D,OAAS,WACXH,EAAQxD,IAEVA,EAAI4D,QAAU,WACZH,EAAOI,MAAM,sBAAD,OAAuB7E,MAErCgB,EAAIhB,IAAMA,MAGN8E,EAAe,SAAC9D,GAA8C,IAAvB+D,EAAsB,uDAAR,IACjDf,EAAkBhD,EAAlBgD,OAAQD,EAAU/C,EAAV+C,MAChB,GAAIA,EAAQC,EAASH,EACnB,MAAO,CACLmB,EAAGD,EACHE,EAAGjB,EAASD,EAAQgB,GAGtB,IAAMG,EAAMC,KAAKC,MAAML,EAAMlB,GAC7B,MAAO,CACLmB,EAAGjB,EAAQC,EAASkB,EACpBD,EAAGC,IAKHG,EAAoB,WAEH,IADrBN,EACoB,uDADd,IAEAO,EAAQP,EAAM,IACdQ,GAAS,IAAIC,MAAOC,UAAY,GAEhCC,EAAI,IACJC,EAAOD,EAAI,GACXE,EAAQT,KAAKU,KAAKN,EAAQ,IAC1BO,EAAa,EAAI,EAAIX,KAAKY,GAAKH,EAC/BI,EAAI,GACJC,EAAI,GACJC,EAAK,CAACF,EAAIT,EAAQI,EAAMM,GACxBE,EAAK,CAACH,EAAGC,EAAIP,EAAIP,KAAKiB,IAAIR,IAE1BS,EAAK,CACTL,EAAIT,EAAQI,EAAOD,EAAIP,KAAKmB,IAAIR,GAChCG,EAAIP,EAAIP,KAAKiB,IAAIN,IAEnB,MAAO,CAACI,EAAIC,EAAIE,GAAKE,KACnB,SAAAC,GAAK,OAAIA,EAAMD,KAAI,SAACP,GAAD,OAAOA,EAAIV,SAI5BmB,EAAkB,SACtBC,GAEuB,IADvB3B,EACsB,uDADhB,IAEAG,EAAMC,KAAKC,MAAML,EAAMlB,GACvBI,EAASH,EAAaiB,EAAKG,GAC3B7E,EAAM4D,EAAOG,WAAW,MAC9B,GAAI/D,EAAK,CACP,IAAMiF,EAAQP,EAAM,KACpB1E,EAAIsG,YAAc,GAClB,IAAMC,EAAYvB,EAAkBN,GAEpC6B,EAAUC,SAAQ,SAACC,GAAc,IAAD,cACfA,EADe,GACvBd,EADuB,KACpBC,EADoB,KAE9B5F,EAAI0G,UACFL,EACAV,EAAGC,EACHS,EAAa3C,MAAQuB,EACrBoB,EAAa1C,OAASsB,MAK5B,OAAOrB,G,4CAKF,WACL+C,EACA9F,EACAC,GAHK,iDAAA8F,EAAA,yDAILC,EAJK,+BAIM,yBAENF,EANA,yCAOIzC,QAAQE,OAAR,kEAA0EuC,KAP9E,UASCjC,EAAM,KACNG,EAAMC,KAAKC,MAAML,EAAMlB,GACvBsD,EAAarD,EAAmB,EAANiB,EAASG,GAEzB,QADVkC,EAAUD,EAAW/C,WAAW,OAZjC,yCAcIG,QAAQE,OAAO,sDAdnB,wBAiBwDF,QAAQ8C,IAAI,CACvE/C,EAAU0C,GACV1C,EAAUZ,GACVY,EAAUV,KApBP,2CAiBE0D,EAjBF,KAiBkBC,EAjBlB,KAiBkCb,EAjBlC,KAwBLU,EAAQL,UAAUQ,EAAgB,EAAG,EAAGxC,EAAKG,GAGvCsC,EAAgB1C,EAAawC,EAAgBvC,GACnDqC,EAAQL,UACNO,EACAvC,EACA,EACAyC,EAAcxC,EACdwC,EAAcvC,GAIhBmC,EAAQK,OACRL,EAAQM,UAAY,SACpBN,EAAQO,KAAO,EAAI,IAAM5C,EAAM,iBAC/BqC,EAAQQ,SACN1G,EACA,IAAM,IAAM6D,EACZ,GAAYA,GAEdqC,EAAQS,UAGRT,EAAQK,OACRL,EAAQM,UAAY,SACpBN,EAAQO,KAAO,EAAI,IAAM5C,EAAM,iBACzB+C,EAAO,IAAItC,KACjB4B,EAAQQ,SACNE,EAAKC,cAAcC,WACnB,GAAK,IAAMjD,EACX,GAAYA,GAEdqC,EAAQQ,UACL,MAAQE,EAAKG,WAAa,IAAIC,OAAO,GACtC,GAAK,IAAMnD,EACX,GAAYA,GAEdqC,EAAQQ,UACL,KAAOE,EAAKrC,WAAWyC,OAAO,GAC/B,IAAM,IAAMnD,EACZ,GAAYA,GAEdqC,EAAQS,UAGRT,EAAQK,OACRL,EAAQM,UAAY,SACpBN,EAAQO,KAAO,EAAI,IAAM5C,EAAM,WAC/BqC,EAAQQ,SACNV,EACA,GAAK,IAAMnC,EACX,KAAO,KAAOA,GAEhBqC,EAAQM,UAAY,QACpBN,EAAQQ,SACNzG,EAAOgH,QAAQ,GAAGC,QAAQ,oBAAqB,OAC/C,IAAM,KAAOrD,EACb,KAAO,KAAOA,GAEhBqC,EAAQS,UAIRT,EAAQL,UACNN,EAAgBC,EAAc3B,GAC9BA,EAAM,EACN,GA3FG,kBA8FE,IAAIR,SAAQ,SAACC,EAASC,GAC3B0C,EAAWkB,QAAO,SAAUC,GACb,OAATA,EACF9D,EAAQ8D,GAER7D,EAAO,uCAnGR,6C,sBC3FA,IAAM8D,EAAW,WAAO,IACrBhI,EAAUgB,qBAAWH,GAArBb,MACFiI,EAAMC,iBAA4B,MACxCC,qBAAU,WACRF,EAAIG,QAAUpI,IACb,CAACA,IACJ,IAAMqI,EAAWnH,uBAAY,WAC3B,GAAK+G,EAAIG,QAAT,CADiC,MAIHH,EAAIG,SDiF/B,SAAP,uCChFIE,CALiC,EAIzB7H,IAJyB,EAIpBE,KAJoB,EAIdC,QACc2H,MAAK,SAACR,GACrCS,iBAAOT,EAAM,oBACZU,OAAM,SAAAtH,GAAWQ,QAAQD,MAAMP,SACjC,IACH,OACE,yBAAK3B,UAAU,SAEXQ,EAAMS,KAAOT,EAAMW,MAAQX,EAAMY,OAAS,EAEtC,kBAACsC,EAAD,CACEf,MAAM,uCACNW,OAAK,EACLD,QAASwF,IAGX,OClBCK,EAAUpJ,IAAMC,MARZ,kBACf,kBAACuB,EAAD,KACE,kBAACC,EAAD,MACA,kBAACwB,EAAD,MACA,kBAAC,EAAD,UCRSoG,EAAiB,kBAC5B,yBAAKnJ,UAAU,OACb,kFACA,sECkBWoJ,EAjBH,WACV,IAAMC,EAAW9F,mBAAQ,WAEvB,OADS+F,UAAUC,UAAUC,cACnBC,QAAQ,mBAAqB,IACtC,IACH,OACE,kBAAC,WAAD,KACE,kBAAC5J,EAAD,MAEEwJ,EACI,kBAAC,EAAD,MACA,kBAACH,EAAD,QCZZQ,IAASC,OAAO,kBAAC,EAAD,MAASxF,SAASyF,eAAe,U,gBCLjDC,EAAOC,QAAU,89J","file":"static/js/main.cc33b0c1.chunk.js","sourcesContent":["import React from 'react';\nimport logoImg from '../assets/logo.png';\n\nconst _HeaderBar = () => (\n  <div>\n    <div className=\"h-10\"></div>\n    <div\n      className={`\n        top-0 inset-x-0 fixed\n        flex h-10\n        items-center\n        bg-white\n        z-50\n      `}\n    >\n      <img src={logoImg} alt=\"Bank of Akat\" className=\"w-8 h-8 mx-5\" />\n      <div className=\"text-lg\">Bank of Akat</div>\n    </div>\n  </div >\n);\n\nexport const HeaderBar = React.memo(_HeaderBar, () => true);\n","import React from 'react';\n\nexport function simpleContext<StateType, ActionType>(\n  reducer: React.Reducer<StateType, ActionType>,\n  initialState: StateType,\n) {\n  const defaultDispatch: React.Dispatch<ActionType> = () => initialState // we never actually use this\n\n  const ctx = React.createContext({\n    state: initialState,\n    dispatch: defaultDispatch, // just to mock out the dispatch type and make it not optioanl\n  })\n\n  function Provider(props: React.PropsWithChildren<{}>) {\n    const [state, dispatch] = React.useReducer<React.Reducer<StateType, ActionType>>(reducer, initialState)\n    return <ctx.Provider value={{ state, dispatch }} {...props} />\n  }\n\n  return [ctx, Provider] as const;\n}\n","import { simpleContext } from '../shared/simple-context';\n\ntype ActionType =\n  | { type: 'SET_IMG', payload: string }\n  | { type: 'SET_NAME', payload: string }\n  | { type: 'SET_AMOUNT', payload: number };\n\nconst initialState = {\n  img: '',\n  name: '',\n  amount: 0,\n};\n\ntype AppState = typeof initialState\n\nfunction reducer(state: AppState, action: ActionType): AppState {\n  switch (action.type) {\n    case 'SET_IMG':\n      return {\n        ...state,\n        img: action.payload,\n      };\n    case 'SET_NAME':\n      return {\n        ...state,\n        name: action.payload,\n      };\n    case 'SET_AMOUNT':\n      return {\n        ...state,\n        amount: action.payload,\n      };\n    default:\n      return state;\n  }\n}\n\nexport const [InvoiceContext, InvoiceProvider] = simpleContext(reducer, initialState);\n","import React, { useCallback } from 'react';\nimport { InvoiceContext } from './context';\n\nconst _ChooseImage = () => {\n  const { dispatch, state } = React.useContext(InvoiceContext);\n\n  const handleInputChange = useCallback(\n    (e: React.FormEvent<HTMLInputElement>): void => {\n      const files = (e.target as HTMLInputElement).files;\n      if (!files) {\n        return;\n      }\n      try {\n        const url = window.URL.createObjectURL(files[0]);\n        dispatch({\n          type: 'SET_IMG',\n          payload: url,\n        });\n      } catch (error) {\n        console.warn('Unable to convert to url, %s', error);\n      }\n    },\n    [dispatch],\n  );\n\n  const { img } = state;\n  const labelCls = \"block bg-white h-full pt-32 \" +\n    (img ? 'opacity-0' : '');\n  return (\n    <div className=\"text-center\">\n      <div className=\"rounded w-64 h-64 mx-auto my-4 relative\">\n        <input\n          id=\"upload-file\"\n          type=\"file\"\n          className=\"absolute w-0 h-0\"\n          accept=\"image/*\"\n          onChange={handleInputChange}\n        />\n        {\n          img\n            ? (\n              <img\n                src={img}\n                alt=\"screenshot\"\n                className=\"h-full absolute inset-0 mx-auto\"\n              />\n            )\n            : null\n        }\n        <label\n          className={labelCls}\n          htmlFor=\"upload-file\"\n        >\n          上传转账截图\n        </label>\n      </div>\n    </div>\n  );\n}\n\nexport const ChooseImage = React.memo(_ChooseImage);\n","import React from 'react';\n\nconst _Input = ({\n  label,\n  onChange,\n  value,\n  placeholder,\n  type,\n}: React.HTMLProps<HTMLInputElement>) => (\n    <div className=\"flex mx-10 mb-4 items-center\">\n      <span\n        className=\"w-20\"\n      >{label}:</span>\n      <input\n        type={type}\n        className=\"flex-1 p-1\"\n        placeholder={placeholder}\n        onChange={onChange}\n        value={value}\n      />\n    </div>\n  );\n\n_Input.defaultProps = {\n  onChange: () => { },\n  value: '',\n  placeholder: '',\n  type: 'text',\n  label: '',\n}\n\nexport const Input = React.memo(_Input);\n","import React, { useContext, useCallback, Fragment } from 'react';\nimport { Input } from '../shared/name-input';\nimport { InvoiceContext } from './context';\n\nconst _Info = () => {\n  const { state, dispatch } = useContext(InvoiceContext);\n  const onNameChange = useCallback(\n    (e: React.FormEvent<HTMLInputElement>): void => {\n      dispatch({\n        type: 'SET_NAME',\n        payload: (e.target as HTMLInputElement).value,\n      });\n    },\n    [dispatch],\n  );\n\n  const onAmountChange = useCallback(\n    (e: React.FormEvent<HTMLInputElement>): void => {\n      dispatch({\n        type: 'SET_AMOUNT',\n        payload: +(e.target as HTMLInputElement).value,\n      });\n    },\n    [dispatch],\n  );\n\n  return (\n    <div>\n      {\n        state.img\n          ? (\n            <Fragment>\n              <Input\n                value={state.name}\n                onChange={onNameChange}\n                inputMode=\"text\"\n                placeholder=\"input your name\"\n                label=\"Account\"\n              />\n              <Input\n                value={state.amount}\n                onChange={onAmountChange}\n                inputMode=\"numeric\"\n                placeholder=\"input the amount\"\n                pattern=\"^\\d*$\"\n                label=\"Amount\"\n              />\n            </Fragment>\n\n          )\n          : null\n      }\n    </div>\n  )\n}\n\nexport const Info = React.memo(_Info);\n","import React, { useMemo } from 'react';\n\ndeclare type ButtonType =\n  | 'primary'\n  | 'info'\n  | 'success'\n  | 'warn'\n  | 'error';\n\ntype ButtonProps = {\n  label: string;\n} & typeof defaultProps;\n\nconst defaultProps = {\n  onClick: () => { },\n  type: 'primary' as ButtonType,\n  block: false,\n};\n\nconst _Button = (\n  {\n    label,\n    onClick,\n    type,\n    block,\n  }: ButtonProps\n) => {\n  const className = useMemo(() => {\n    const base = `rounded text-center py-2 px-6 text-white`;\n    let _type = 'blue';\n    switch (type) {\n      case 'primary':\n        break;\n      case 'success':\n        _type = 'green';\n        break;\n      case 'info':\n        _type = 'gray';\n        break;\n      case 'warn':\n        _type = 'yellow';\n        break;\n      case 'error':\n        _type = 'red';\n        break;\n      default:\n        break;\n    }\n    const _block = block === true\n      ? 'block w-full'\n      : '';\n    return `${base} bg-${_type}-500 ${_block}`;\n  }, [block, type]);\n  return (\n    <button\n      className={className}\n      onClick={onClick}\n    >\n      {label}\n    </button>\n  )\n}\n\n_Button.defaultProps = defaultProps;\n\nexport const Button = React.memo(_Button);\n","const certificatePath = process.env.PUBLIC_URL + '/certificate.png';\nconst watermarkPath = process.env.PUBLIC_URL + '/watermark.png';\n\nconst ROOT_2 = 1.4142135623730951;\n\nfunction createCanvas(width: number, height?: number): HTMLCanvasElement {\n  height = height || width;\n  const canvas: HTMLCanvasElement = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n\n  const ctx = canvas.getContext('2d');\n  ctx?.clearRect(0, 0, width, height);\n\n  return canvas;\n}\n\nconst loadImage = (src: string): Promise<HTMLImageElement> => new Promise((resolve, reject) => {\n  const img = document.createElement('img');\n  img.setAttribute(\"crossOrigin\", 'Anonymous');\n  img.onload = function onload() {\n    resolve(img);\n  };\n  img.onerror = () => {\n    reject(Error(`Fail to load image ${src}`));\n  }\n  img.src = src;\n});\n\nconst imageContain = (img: HTMLImageElement, a4w: number = 210) => {\n  const { height, width } = img;\n  if (width / height < ROOT_2) {\n    return {\n      w: a4w,\n      h: height / width * a4w,\n    }\n  } else {\n    const a4h = Math.round(a4w * ROOT_2);\n    return {\n      w: width / height * a4h,\n      h: a4h,\n    }\n  }\n}\n\nconst watermarkPosition = (\n  a4w = 210,\n): Array<number[]> => {\n  const ratio = a4w / 210;\n  const today = (new Date().getDate() % 11);\n\n  const l = 150;\n  const step = l / 10;\n  const theta = Math.acos(today / 10);\n  const patchTheta = 2 / 3 * Math.PI - theta;\n  const x = 30;\n  const y = 30;\n  const p1 = [x + today * step, y];\n  const p2 = [x, y + l * Math.sin(theta)];\n\n  const p3 = [\n    x + today * step + l * Math.cos(patchTheta),\n    y + l * Math.sin(patchTheta)\n  ];\n  return [p1, p2, p3,].map(\n    point => point.map((x) => x * ratio)\n  );\n}\n\nconst watermarkCanvas = (\n  watermarkPNG: HTMLImageElement,\n  a4w = 210,\n): HTMLCanvasElement => {\n  const a4h = Math.round(a4w * ROOT_2);\n  const canvas = createCanvas(a4w, a4h);\n  const ctx = canvas.getContext('2d');\n  if (ctx) {\n    const ratio = a4w / 2100;\n    ctx.globalAlpha = 0.7;\n    const positions = watermarkPosition(a4w);\n\n    positions.forEach((position) => {\n      const [x, y] = position;\n      ctx.drawImage(\n        watermarkPNG,\n        x, y,\n        watermarkPNG.width * ratio,\n        watermarkPNG.height * ratio,\n      );\n    });\n  }\n\n  return canvas;\n}\n\ntype CurrencyType = '人民币/CNY' | '美元/$';\n\nexport async function generateImage(\n  imgSrc: string,\n  name: string,\n  amount: number,\n  currency = '人民币/CNY' as CurrencyType,\n): Promise<Blob> {\n  if (!imgSrc) {\n    return Promise.reject(`You have to pass the valid string for \"imgSrc\", but got ${imgSrc}`);\n  }\n  const a4w = 1050;\n  const a4h = Math.round(a4w * ROOT_2);\n  const rootCanvas = createCanvas(a4w * 2, a4h);\n  const rootCtx = rootCanvas.getContext('2d');\n  if (rootCtx === null) {\n    return Promise.reject('Failed to generate Image, retry it later, please.');\n  }\n\n  const [transcationPNG, certificatePNG, watermarkPNG] = await Promise.all([\n    loadImage(imgSrc),\n    loadImage(certificatePath),\n    loadImage(watermarkPath),\n  ]);\n\n  // draw image background\n  rootCtx.drawImage(certificatePNG, 0, 0, a4w, a4h);\n\n  // draw transaction screenshoot\n  const transcationWH = imageContain(transcationPNG, a4w);\n  rootCtx.drawImage(\n    transcationPNG,\n    a4w,\n    0,\n    transcationWH.w,\n    transcationWH.h,\n  );\n\n  // draw name\n  rootCtx.save();\n  rootCtx.textAlign = 'center';\n  rootCtx.font = 9 / 210 * a4w + 'px PingFang SC';\n  rootCtx.fillText(\n    name,\n    150 / 210 * a4w,\n    105 / 210 * a4w,\n  );\n  rootCtx.restore();\n\n  // draw date\n  rootCtx.save();\n  rootCtx.textAlign = 'center';\n  rootCtx.font = 9 / 210 * a4w + 'px PingFang SC';\n  const date = new Date();\n  rootCtx.fillText(\n    date.getFullYear().toString(),\n    37 / 210 * a4w,\n    105 / 210 * a4w,\n  );\n  rootCtx.fillText(\n    ('00' + (date.getMonth() + 1)).slice(-2),\n    72 / 210 * a4w,\n    105 / 210 * a4w,\n  );\n  rootCtx.fillText(\n    ('00' + date.getDate()).slice(-2),\n    102 / 210 * a4w,\n    105 / 210 * a4w,\n  );\n  rootCtx.restore();\n\n  // draw currency\n  rootCtx.save();\n  rootCtx.textAlign = 'center';\n  rootCtx.font = 5 / 210 * a4w + 'px serif';\n  rootCtx.fillText(\n    currency,\n    23 / 210 * a4w,\n    1925 / 2100 * a4w,\n  );\n  rootCtx.textAlign = 'start';\n  rootCtx.fillText(\n    amount.toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, '$&,'),\n    550 / 2100 * a4w,\n    1925 / 2100 * a4w,\n  );\n  rootCtx.restore();\n\n\n  // draw watermark\n  rootCtx.drawImage(\n    watermarkCanvas(watermarkPNG, a4w),\n    a4w / 2,\n    0\n  );\n\n  return new Promise((resolve, reject) => {\n    rootCanvas.toBlob(function (blob) {\n      if (blob !== null) {\n        resolve(blob);\n      } else {\n        reject('Failed to convert to canvas.');\n      }\n    });\n  })\n}\n","import React, { useContext, useRef, useEffect, useCallback } from 'react';\nimport { saveAs } from 'file-saver';\nimport { InvoiceContext } from './context';\nimport { Button } from '../shared/button';\nimport { generateImage } from './generateImage';\n\nexport const Generate = () => {\n  const { state } = useContext(InvoiceContext);\n  const ref = useRef<typeof state | null>(null);\n  useEffect(() => {\n    ref.current = state;\n  }, [state]);\n  const generate = useCallback(() => {\n    if (!ref.current) {\n      return;\n    }\n    const { img, name, amount } = ref.current;\n    generateImage(img, name, amount).then((blob) => {\n      saveAs(blob, 'generated.png');\n    }).catch(e => void (console.error(e)));\n  }, []);\n  return (\n    <div className=\"mx-20\">\n      {\n        state.img && state.name && state.amount > 0\n          ? (\n            <Button\n              label=\"生成收据🧾\"\n              block\n              onClick={generate}\n            />\n          )\n          : null\n      }\n    </div>\n  );\n}\n","import React from 'react';\nimport { ChooseImage } from './choose-image';\nimport { InvoiceProvider } from './context';\nimport { Info } from './info';\nimport { Generate } from './generate';\n\nconst _Invoice = () => (\n  <InvoiceProvider>\n    <ChooseImage />\n    <Info />\n    <Generate />\n  </InvoiceProvider>\n);\n\nexport const Invoice = React.memo(_Invoice);\n","import React from 'react';\n\nexport const WeiXinFallback = () => (\n  <div className=\"m-4\">\n    <h4>Some features are not supported in WeChat browser.</h4>\n    <h3>Please use Safari or other browsers.</h3>\n  </div>\n)\n","import React, { Fragment, useMemo } from 'react';\nimport './App.scss';\nimport { HeaderBar } from './shared/header-bar';\nimport { Invoice } from './invoice';\nimport { WeiXinFallback } from './shared/weixin-fallback';\n\nconst App = () => {\n  const isWeixin = useMemo(() => {\n    var ua = navigator.userAgent.toLowerCase();\n    return ua.indexOf('micromessenger') > -1;\n  }, []);\n  return (\n    <Fragment>\n      <HeaderBar />\n      {\n        isWeixin\n          ? <WeiXinFallback />\n          : <Invoice />\n      }\n    </Fragment>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","module.exports = \"data:image/png;base64,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\""],"sourceRoot":""}